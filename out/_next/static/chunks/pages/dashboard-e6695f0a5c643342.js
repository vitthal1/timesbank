(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{6117:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(2321)}])},2321:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return eT}});var a=t(5893),r=t(645),l=t.n(r),i=t(7294),n=t(39),d=t(437),c=t(5412),o=t(2217),x=t(116),m=t(6611),h=t(9176),u=t(88),b=t(3488),g=t(4235),p=t(893),f=t(3416),j=t(6428),y=t(2171),N=t(775),w=t(6781),v=t(1163);function _(e){let{children:s}=e,{user:t,loading:r}=(0,w.a)(),l=(0,v.useRouter)();return((0,i.useEffect)(()=>{r||t||l.push("/auth/login")},[t,r,l]),r)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,a.jsx)(a.Fragment,{children:s})}var k=t(9263),S=t(4976),C=t(9810);function A(e){let{userId:s}=e,[t,r]=(0,i.useState)(0),[l,c]=(0,i.useState)(0),[o,x]=(0,i.useState)(0),[m,h]=(0,i.useState)(!0),[u,b]=(0,i.useState)(!1),g=async()=>{try{let{data:e,error:t}=await k.O.from("users").select("time_balance, total_hours_given, total_hours_received").eq("id",s).single();if(t){console.error("Error fetching user balance:",t);return}e&&(r(e.time_balance||0),c(e.total_hours_given||0),x(e.total_hours_received||0))}catch(e){console.error("Error fetching balance:",e)}finally{h(!1),b(!1)}};(0,i.useEffect)(()=>{g();let e=k.O.channel("user-balance-".concat(s)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"users",filter:"id=eq.".concat(s)},e=>{e.new&&(r(e.new.time_balance||0),c(e.new.total_hours_given||0),x(e.new.total_hours_received||0))}).subscribe();return()=>{e.unsubscribe()}},[s]);let p=t>=0,f=0===t;return(0,a.jsxs)("div",{className:"relative overflow-hidden bg-gradient-to-br from-purple-500 via-purple-600 to-pink-600 rounded-2xl shadow-2xl p-6 text-white",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-white/10 rounded-full blur-2xl"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 -mb-4 -ml-4 w-24 h-24 bg-white/10 rounded-full blur-2xl"}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:(0,a.jsx)(n.Z,{className:"w-6 h-6"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Time Balance"})]}),(0,a.jsx)("button",{onClick:()=>{b(!0),g()},disabled:u,className:"bg-white/20 hover:bg-white/30 p-2 rounded-lg backdrop-blur-sm transition-all disabled:opacity-50",title:"Refresh balance",children:(0,a.jsx)(S.Z,{className:"w-5 h-5 ".concat(u?"animate-spin":"")})})]}),m?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 mb-6 md:mb-0",children:[(0,a.jsxs)("div",{className:"flex items-baseline space-x-2",children:[(0,a.jsx)("span",{className:"text-16xl md:text-7xl font-extrabold",children:Math.abs(t)}),(0,a.jsx)("span",{className:"text-xl font-medium opacity-90",children:"hours"})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:f?(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-white/20 px-3 py-1 rounded-full text-sm backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"}),(0,a.jsx)("span",{children:"Balanced"})]}):p?(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-green-400/30 px-3 py-1 rounded-full text-sm backdrop-blur-sm",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Credit"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-orange-400/30 px-3 py-1 rounded-full text-sm backdrop-blur-sm",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Debt"})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:w-1/3",children:[(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 text-green-300"}),(0,a.jsx)("p",{className:"text-sm font-medium opacity-90",children:"Received"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:o}),(0,a.jsx)("p",{className:"text-xs opacity-75 mt-1",children:"hours"})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4 text-orange-300"}),(0,a.jsx)("p",{className:"text-sm font-medium opacity-90",children:"Given"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:l}),(0,a.jsx)("p",{className:"text-xs opacity-75 mt-1",children:"hours"})]})]})]}),(0,a.jsxs)("p",{className:"text-xs opacity-75 mt-6 text-center",children:[p&&!f&&"You have time credits to use",!p&&"Contribute time to earn credits",f&&"Your time is perfectly balanced"]})]})]})]})}var E=t(8655),F=t(3050),T=t(8887),D=t(3603),Z=t(4598);let R={TRANSFER_FEE_PERCENTAGE:.02,TRANSFER_FEE_DISPLAY:"2%",MIN_TRANSFER_AMOUNT:.01,MAX_TRANSFER_AMOUNT:1e3,DECIMAL_PLACES:2};function L(e){let s=parseFloat(e.toFixed(R.DECIMAL_PLACES)),t=parseFloat((s*R.TRANSFER_FEE_PERCENTAGE).toFixed(R.DECIMAL_PLACES)),a=parseFloat((s+t).toFixed(R.DECIMAL_PLACES));return{transferAmount:s,feeAmount:t,totalAmount:a,feePercentage:100*R.TRANSFER_FEE_PERCENTAGE}}function O(e,s){let{totalAmount:t}=L(s),a=e>=t;return{sufficient:a,shortfall:parseFloat((a?0:t-e).toFixed(R.DECIMAL_PLACES)),required:t}}function M(e){return e.toFixed(R.DECIMAL_PLACES)}function P(e){let{userId:s}=e,[t,r]=(0,i.useState)(""),[n,d]=(0,i.useState)(""),[c,o]=(0,i.useState)(""),[x,m]=(0,i.useState)(!1),[h,u]=(0,i.useState)(""),[b,g]=(0,i.useState)(""),[p,f]=(0,i.useState)(0);(0,i.useEffect)(()=>{j()},[s]);let j=async()=>{try{let{data:e,error:t}=await k.O.from("users").select("time_balance").eq("id",s).single();if(t)throw t;f((null==e?void 0:e.time_balance)||0)}catch(e){console.error("Error fetching balance:",e)}},y=async e=>{e.preventDefault(),u(""),g(""),m(!0);try{let e=parseFloat(n);if(!t.trim())throw Error("Please enter a recipient username");let a=isNaN(e)?{valid:!1,error:"Please enter a valid number"}:e<R.MIN_TRANSFER_AMOUNT?{valid:!1,error:"Minimum transfer amount is ".concat(R.MIN_TRANSFER_AMOUNT," hours")}:e>R.MAX_TRANSFER_AMOUNT?{valid:!1,error:"Maximum transfer amount is ".concat(R.MAX_TRANSFER_AMOUNT," hours")}:{valid:!0};if(!a.valid)throw Error(a.error);if(!O(p,e).sufficient)throw Error(function(e,s){let{totalAmount:t,feeAmount:a}=L(s);return"Insufficient balance. You need ".concat(M(t)," hours ")+"(".concat(M(s)," + ").concat(M(a)," fee) ")+"but have ".concat(M(e)," hours")}(p,e));let{data:l,error:i}=await k.O.from("users").select("id, username").eq("username",t.trim()).single();if(i||!l)throw Error("Recipient user not found");if(l.id===s)throw Error("You cannot transfer time to yourself");let{data:x,error:m}=await k.O.rpc("transfer_time_with_fee",{p_from_user_id:s,p_to_user_id:l.id,p_hours:e,p_note:c.trim()||null});if(m)throw m;let h=function(e){let s=L(e);return{transferAmount:M(s.transferAmount),feeAmount:M(s.feeAmount),totalAmount:M(s.totalAmount),feePercentage:R.TRANSFER_FEE_DISPLAY}}(e);g("Successfully transferred ".concat(h.transferAmount," hours to ").concat(l.username,". ")+"TimeBank fee: ".concat(h.feeAmount," hours (").concat(h.feePercentage,").")),r(""),d(""),o(""),await j(),setTimeout(()=>g(""),5e3)}catch(e){console.error("Transfer error:",e),u(e.message||"Failed to complete transfer")}finally{m(!1)}},N=parseFloat(n)||0,w=N>0?L(N):null,v=N>0?O(p,N):null,_=v&&!v.sufficient;return(0,a.jsxs)("form",{onSubmit:y,className:"jsx-7b7a93ffcdd76454 space-y-4",children:[(0,a.jsx)("div",{className:"jsx-7b7a93ffcdd76454 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex items-center justify-between",children:[(0,a.jsx)("span",{className:"jsx-7b7a93ffcdd76454 text-sm font-medium text-blue-900",children:"Available Balance"}),(0,a.jsxs)("span",{className:"jsx-7b7a93ffcdd76454 text-lg font-bold text-blue-600",children:[p.toFixed(R.DECIMAL_PLACES)," hrs"]})]})}),h&&(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start gap-2 animate-shake",children:[(0,a.jsx)(E.Z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,a.jsx)("p",{className:"jsx-7b7a93ffcdd76454 text-sm text-red-800",children:h})]}),b&&(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 bg-green-50 border border-green-200 rounded-lg p-3 flex items-start gap-2 animate-slideDown",children:[(0,a.jsx)(F.Z,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),(0,a.jsx)("p",{className:"jsx-7b7a93ffcdd76454 text-sm text-green-800",children:b})]}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454",children:[(0,a.jsx)("label",{htmlFor:"recipient",className:"jsx-7b7a93ffcdd76454 block text-sm font-semibold text-gray-700 mb-1",children:"Recipient Username"}),(0,a.jsx)("input",{id:"recipient",type:"text",value:t,onChange:e=>r(e.target.value),placeholder:"Enter username",disabled:x,required:!0,className:"jsx-7b7a93ffcdd76454 w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454",children:[(0,a.jsx)("label",{htmlFor:"hours",className:"jsx-7b7a93ffcdd76454 block text-sm font-semibold text-gray-700 mb-1",children:"Hours to Transfer"}),(0,a.jsx)("input",{id:"hours",type:"number",step:"0.01",min:R.MIN_TRANSFER_AMOUNT,max:R.MAX_TRANSFER_AMOUNT,value:n,onChange:e=>d(e.target.value),placeholder:"0.00",disabled:x,required:!0,className:"jsx-7b7a93ffcdd76454 "+"w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(_?"border-red-300 bg-red-50":"border-gray-300")}),(0,a.jsxs)("p",{className:"jsx-7b7a93ffcdd76454 text-xs text-gray-500 mt-1",children:["Min: ",R.MIN_TRANSFER_AMOUNT," hrs | Max: ",R.MAX_TRANSFER_AMOUNT," hrs"]})]}),w&&(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 border-2 border-amber-200 rounded-xl p-4 space-y-3 shadow-sm",children:[(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"jsx-7b7a93ffcdd76454 w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(T.Z,{className:"w-4 h-4 text-amber-700"})}),(0,a.jsx)("span",{className:"jsx-7b7a93ffcdd76454 text-sm font-bold text-amber-900",children:"Transaction Breakdown"})]}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 space-y-2 text-sm bg-white/60 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex justify-between items-center text-gray-700",children:[(0,a.jsx)("span",{className:"jsx-7b7a93ffcdd76454",children:"Transfer Amount:"}),(0,a.jsxs)("span",{className:"jsx-7b7a93ffcdd76454 font-semibold text-gray-900",children:[w.transferAmount.toFixed(R.DECIMAL_PLACES)," hrs"]})]}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex justify-between items-center text-gray-700",children:[(0,a.jsxs)("span",{className:"jsx-7b7a93ffcdd76454",children:["TimeBank Fee (",R.TRANSFER_FEE_DISPLAY,"):"]}),(0,a.jsxs)("span",{className:"jsx-7b7a93ffcdd76454 font-semibold text-amber-700",children:["+",w.feeAmount.toFixed(R.DECIMAL_PLACES)," hrs"]})]}),(0,a.jsx)("div",{className:"jsx-7b7a93ffcdd76454 border-t-2 border-amber-200 pt-2 mt-2"}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex justify-between items-center font-bold text-base",children:[(0,a.jsx)("span",{className:"jsx-7b7a93ffcdd76454 text-gray-900",children:"Total Required:"}),(0,a.jsxs)("span",{className:"jsx-7b7a93ffcdd76454 "+((_?"text-red-600":"text-blue-600")||""),children:[w.totalAmount.toFixed(R.DECIMAL_PLACES)," hrs"]})]}),_&&v&&(0,a.jsx)("div",{className:"jsx-7b7a93ffcdd76454 bg-red-50 border border-red-200 rounded-lg p-2 mt-2",children:(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex items-center gap-2",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 text-xs text-red-700",children:[(0,a.jsx)("p",{className:"jsx-7b7a93ffcdd76454 font-semibold",children:"Insufficient Balance"}),(0,a.jsxs)("p",{className:"jsx-7b7a93ffcdd76454",children:["You need ",v.shortfall.toFixed(R.DECIMAL_PLACES)," more hours"]})]})]})})]})]}),(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454",children:[(0,a.jsx)("label",{htmlFor:"note",className:"jsx-7b7a93ffcdd76454 block text-sm font-semibold text-gray-700 mb-1",children:"Note (Optional)"}),(0,a.jsx)("textarea",{id:"note",value:c,onChange:e=>o(e.target.value),placeholder:"Add a message about this transfer...",rows:3,disabled:x,maxLength:500,className:"jsx-7b7a93ffcdd76454 w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"}),(0,a.jsxs)("p",{className:"jsx-7b7a93ffcdd76454 text-xs text-gray-500 mt-1",children:[c.length,"/500 characters"]})]}),(0,a.jsx)("button",{type:"submit",disabled:x||_||!t||!n,className:"jsx-7b7a93ffcdd76454 "+"w-full py-3.5 px-4 rounded-xl font-bold text-base transition-all flex items-center justify-center gap-2 shadow-md ".concat(x||_||!t||!n?"bg-gray-300 text-gray-500 cursor-not-allowed shadow-none":"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]"),children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"jsx-7b7a93ffcdd76454 w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing Transfer..."]}):_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{className:"w-5 h-5"}),"Insufficient Balance"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(D.Z,{className:"w-5 h-5"}),"Transfer Time"]})}),(0,a.jsx)("div",{className:"jsx-7b7a93ffcdd76454 bg-blue-50 border border-blue-100 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"jsx-7b7a93ffcdd76454 flex items-start gap-2",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("p",{className:"jsx-7b7a93ffcdd76454 text-xs text-blue-800",children:["A ",(0,a.jsx)("strong",{className:"jsx-7b7a93ffcdd76454",children:R.TRANSFER_FEE_DISPLAY})," fee is applied to all transfers to support and maintain the TimeBank platform. This fee goes directly to the platform admin account."]})]})}),(0,a.jsx)(l(),{id:"7b7a93ffcdd76454",children:"@-webkit-keyframes shake{0%,100%{-webkit-transform:translatex(0);transform:translatex(0)}25%{-webkit-transform:translatex(-5px);transform:translatex(-5px)}75%{-webkit-transform:translatex(5px);transform:translatex(5px)}}@-moz-keyframes shake{0%,100%{-moz-transform:translatex(0);transform:translatex(0)}25%{-moz-transform:translatex(-5px);transform:translatex(-5px)}75%{-moz-transform:translatex(5px);transform:translatex(5px)}}@-o-keyframes shake{0%,100%{-o-transform:translatex(0);transform:translatex(0)}25%{-o-transform:translatex(-5px);transform:translatex(-5px)}75%{-o-transform:translatex(5px);transform:translatex(5px)}}@keyframes shake{0%,100%{-webkit-transform:translatex(0);-moz-transform:translatex(0);-o-transform:translatex(0);transform:translatex(0)}25%{-webkit-transform:translatex(-5px);-moz-transform:translatex(-5px);-o-transform:translatex(-5px);transform:translatex(-5px)}75%{-webkit-transform:translatex(5px);-moz-transform:translatex(5px);-o-transform:translatex(5px);transform:translatex(5px)}}@-webkit-keyframes slideDown{from{opacity:0;-webkit-transform:translatey(-10px);transform:translatey(-10px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes slideDown{from{opacity:0;-moz-transform:translatey(-10px);transform:translatey(-10px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes slideDown{from{opacity:0;-o-transform:translatey(-10px);transform:translatey(-10px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes slideDown{from{opacity:0;-webkit-transform:translatey(-10px);-moz-transform:translatey(-10px);-o-transform:translatey(-10px);transform:translatey(-10px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-shake.jsx-7b7a93ffcdd76454{-webkit-animation:shake.3s ease-in-out;-moz-animation:shake.3s ease-in-out;-o-animation:shake.3s ease-in-out;animation:shake.3s ease-in-out}.animate-slideDown.jsx-7b7a93ffcdd76454{-webkit-animation:slideDown.3s ease-out;-moz-animation:slideDown.3s ease-out;-o-animation:slideDown.3s ease-out;animation:slideDown.3s ease-out}"})]})}function q(e){let{userId:s}=e,[t,r]=(0,i.useState)([]),l=async()=>{let{data:e}=await k.O.from("time_ledger").select("*").or("from_user.eq.".concat(s,",to_user.eq.").concat(s)).order("created_at",{ascending:!1});r(e||[])};return(0,i.useEffect)(()=>{l();let e=k.O.channel("time_ledger_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"time_ledger"},e=>{(e.new.from_user===s||e.new.to_user===s)&&r(s=>[e.new,...s])}).subscribe();return()=>{k.O.removeChannel(e)}},[s]),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Transaction History"}),(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("li",{className:"py-2",children:[e.from_user===s?"Sent":"Received"," ",e.hours," hrs - ",e.note]},e.id))})]})}let U=async()=>{let{data:e,error:s}=await k.O.from("skills").select("*");if(s)throw s;return e},I=async e=>{let{data:s,error:t}=await k.O.from("user_skills").select("skill:skill_id(name)").eq("user_id",e);if(t)throw t;return s.map(e=>e.skill)},B=async(e,s)=>{let{data:t,error:a}=await k.O.from("user_skills").insert([{user_id:e,skill_id:s}]);if(a)throw a;return t},z=async(e,s)=>{let{data:t,error:a}=await k.O.from("user_skills").delete().eq("user_id",e).eq("skill_id",s);if(a)throw a;return t},Y=e=>{let{userId:s}=e,[t,r]=(0,i.useState)([]),[l,n]=(0,i.useState)([]),[d,c]=(0,i.useState)(""),[o,x]=(0,i.useState)(!1),[m,h]=(0,i.useState)("");(0,i.useEffect)(()=>{!async function(){r(await U()),n(await I(s))}()},[s]);let u=async e=>{try{if(l.find(s=>s.id===e))await z(s,e),n(s=>s.filter(s=>s.id!==e));else{await B(s,e);let a=t.find(s=>s.id===e);a&&n(e=>[...e,a])}h("")}catch(e){h("Failed to update skill")}},b=async()=>{let e=d.trim();if(!e){h("Please enter a skill name");return}let a=t.find(s=>s.name.toLowerCase()===e.toLowerCase());if(a){l.find(e=>e.id===a.id)||await u(a.id),c(""),x(!1),h("");return}try{let{data:t,error:a}=await k.O.from("skills").insert([{name:e}]).select().single();if(a)throw a;r(e=>[...e,t]),await B(s,t.id),n(e=>[...e,t]),c(""),x(!1),h("")}catch(e){h("Failed to add new skill")}};return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Your Skills"}),!o&&(0,a.jsx)("button",{className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",onClick:()=>x(!0),children:"+ Add Skill"})]}),m&&(0,a.jsx)("div",{className:"mb-3 p-2 bg-red-100 text-red-700 rounded",children:m}),o&&(0,a.jsxs)("div",{className:"mb-4 flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key?b():"Escape"===e.key&&(x(!1),c(""),h(""))},placeholder:"Enter skill name",className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),(0,a.jsx)("button",{onClick:b,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Add"}),(0,a.jsx)("button",{onClick:()=>{x(!1),c(""),h("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Cancel"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map(e=>(0,a.jsx)("button",{className:"px-3 py-1 rounded transition-colors ".concat(l.find(s=>s.id===e.id)?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>u(e.id),children:e.name},e.id))})]})},Q=async e=>{let{data:s,error:t}=await k.O.from("users").select("*").eq("id",e).single();if(t)throw t;return s},H=async(e,s)=>{let{data:t,error:a}=await k.O.from("users").update(s).eq("id",e).select();if(a)throw a;return t};function W(e){let{userId:s}=e,[t,r]=(0,i.useState)(null),[l,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!0),[o,x]=(0,i.useState)(!1),[m,h]=(0,i.useState)(""),[u,b]=(0,i.useState)(""),[g,p]=(0,i.useState)({username:"",email:"",bio:"",avatar_url:""});(0,i.useEffect)(()=>{f()},[s]);let f=async()=>{try{c(!0);let e=await Q(s);e&&(r(e),p({username:e.username||"",email:e.email||"",bio:e.bio||"",avatar_url:e.avatar_url||""}))}catch(e){h("Failed to load user profile")}finally{c(!1)}},j=e=>{let{name:s,value:t}=e.target;p(e=>({...e,[s]:t}))},y=async e=>{e.preventDefault(),h(""),b(""),x(!0);try{await H(s,{username:g.username,bio:g.bio,avatar_url:g.avatar_url}),await f(),b("Profile updated successfully!"),n(!1),setTimeout(()=>b(""),3e3)}catch(e){h("Failed to update profile. Please try again.")}finally{x(!1)}};return d?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),(0,a.jsx)("div",{className:"h-10 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"h-10 bg-gray-200 rounded"})]})}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Profile Information"}),!l&&(0,a.jsx)("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Edit Profile"})]}),m&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:m}),u&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:u}),(0,a.jsx)("form",{onSubmit:y,children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar"}),l?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[g.avatar_url&&(0,a.jsx)("img",{src:g.avatar_url,alt:"Avatar preview",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-300"}),!g.avatar_url&&(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl text-gray-400",children:"\uD83D\uDC64"})})]}),(0,a.jsx)("input",{type:"url",name:"avatar_url",value:g.avatar_url,onChange:j,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com/avatar.jpg"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Enter a URL to your avatar image"})]}):(0,a.jsx)("div",{className:"flex items-center gap-4",children:(null==t?void 0:t.avatar_url)?(0,a.jsx)("img",{src:t.avatar_url,alt:"User avatar",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-300"}):(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl text-gray-400",children:"\uD83D\uDC64"})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Username"}),l?(0,a.jsx)("input",{type:"text",name:"username",value:g.username,onChange:j,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}):(0,a.jsx)("p",{className:"text-gray-900 py-2",children:(null==t?void 0:t.username)||"Not set"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,a.jsx)("p",{className:"text-gray-900 py-2",children:null==t?void 0:t.email}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),l?(0,a.jsx)("textarea",{name:"bio",value:g.bio,onChange:j,rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Tell us about yourself..."}):(0,a.jsx)("p",{className:"text-gray-900 py-2 whitespace-pre-wrap",children:(null==t?void 0:t.bio)||"Not set"})]}),l&&(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?"Saving...":"Save Changes"}),(0,a.jsx)("button",{type:"button",onClick:()=>{t&&p({username:t.username||"",email:t.email||"",bio:t.bio||"",avatar_url:t.avatar_url||""}),n(!1),h("")},disabled:o,className:"px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:cursor-not-allowed",children:"Cancel"})]})]})}),(0,a.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Information"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"User ID:"}),(0,a.jsx)("span",{className:"text-gray-900 font-mono text-xs",children:null==t?void 0:t.id})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Account Created:"}),(0,a.jsx)("span",{className:"text-gray-900",children:(null==t?void 0:t.created_at)?new Date(t.created_at).toLocaleDateString():"Unknown"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Account Type:"}),(0,a.jsx)("span",{className:"font-medium ".concat((null==t?void 0:t.is_admin)?"text-purple-600":"text-gray-900"),children:(null==t?void 0:t.is_admin)?"Admin":"Member"})]})]})]})]})})}var K=t(2126),V=t(3832),G=t(5928),X=t(3279),$=t.n(X);let J=e=>{let s=0;return{score:s=[e.length>=8,/[A-Z]/.test(e),/[a-z]/.test(e),/[0-9]/.test(e),/[!@#$%^&*(),.?":{}|<>]/.test(e)].filter(Boolean).length,label:["Weak","Fair","Good","Strong","Very Strong"][s]||"Weak"}};function ee(){let[e,s]=(0,i.useState)(""),[t,r]=(0,i.useState)(""),[l,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[o,x]=(0,i.useState)(!1),[m,h]=(0,i.useState)(""),[u,b]=(0,i.useState)(""),[g,p]=(0,i.useState)({score:0,label:"Weak"}),{updatePassword:j}=(0,w.a)(),y=(0,i.useCallback)($()(e=>{e&&p(J(e))},300),[]),N=()=>e&&t?e!==t?"New passwords do not match":e.length<6?"New password must be at least 6 characters":g.score<2?"Password is too weak. Please make it stronger.":null:"All fields are required",v=async s=>{s.preventDefault();let t=N();if(h(t||""),b(""),!t){x(!0);try{let s=await j(e);s.success?(b("Password changed successfully!"),_(),setTimeout(()=>b(""),3e3)):h(s.error||"Failed to change password")}catch(e){h("An unexpected error occurred. Please try again.")}finally{x(!1)}}},_=()=>{s(""),r(""),h(""),b(""),p({score:0,label:"Weak"}),n(!1),c(!1)};return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",role:"region","aria-labelledby":"change-password-heading",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center","aria-hidden":"true",children:(0,a.jsx)(f.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{id:"change-password-heading",className:"text-2xl font-bold text-gray-900",children:"Change Password"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Update your password to keep your account secure"})]})]}),m&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg flex items-start gap-2",role:"alert","aria-live":"polite",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,a.jsx)("span",{children:m})]}),u&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg flex items-start gap-2",role:"alert","aria-live":"polite",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,a.jsx)("span",{children:u})]}),(0,a.jsx)("form",{onSubmit:v,noValidate:!0,"aria-describedby":"password-tips",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"new-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(K.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","aria-hidden":"true"}),(0,a.jsx)("input",{id:"new-password",type:l?"text":"password",value:e,onChange:e=>{let t=e.target.value;s(t),y(t),m.includes("password")&&h("")},className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition disabled:bg-gray-50",placeholder:"Enter new password",required:!0,disabled:o,"aria-describedby":"new-password-strength"}),(0,a.jsx)("button",{type:"button",onClick:()=>n(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition disabled:opacity-50",disabled:o,"aria-label":l?"Hide new password":"Show new password",children:l?(0,a.jsx)(V.Z,{className:"w-5 h-5"}):(0,a.jsx)(G.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",id:"new-password-strength",children:"Must be at least 6 characters"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(K.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","aria-hidden":"true"}),(0,a.jsx)("input",{id:"confirm-password",type:d?"text":"password",value:t,onChange:e=>{r(e.target.value),"New passwords do not match"===m&&h("")},className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition disabled:bg-gray-50",placeholder:"Confirm new password",required:!0,disabled:o}),(0,a.jsx)("button",{type:"button",onClick:()=>c(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition disabled:opacity-50",disabled:o,"aria-label":d?"Hide confirm password":"Show confirm password",children:d?(0,a.jsx)(V.Z,{className:"w-5 h-5"}):(0,a.jsx)(G.Z,{className:"w-5 h-5"})})]})]}),e&&(0,a.jsxs)("div",{className:"space-y-2",id:"password-strength-indicator",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Password Strength:"}),(0,a.jsx)("div",{className:"flex gap-1",role:"img","aria-label":"Password strength: ".concat(g.label),children:Array.from({length:5},(e,s)=>(0,a.jsx)("div",{className:"h-2 flex-1 rounded transition-colors ".concat(s<g.score?"bg-green-500":"bg-gray-200"),"aria-hidden":"true"},s))}),(0,a.jsxs)("p",{className:"text-xs font-medium ".concat(g.score>=3?"text-green-600":"text-gray-500"),"aria-live":"polite",children:[g.label," ",g.score<3&&"- Improve for better security"]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:o||!!m,className:"flex-1 bg-purple-600 text-white font-semibold py-3 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Update password",children:o?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin","aria-hidden":"true"}),"Updating..."]}):"Update Password"}),(0,a.jsx)("button",{type:"button",onClick:_,disabled:o,className:"px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Reset form",children:"Reset"})]})]})}),(0,a.jsxs)("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg",id:"password-tips",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Password Security Tips"}),(0,a.jsxs)("ul",{className:"text-xs text-blue-800 space-y-1",role:"list",children:[(0,a.jsx)("li",{children:"• Use at least 8 characters with a mix of letters, numbers, and symbols"}),(0,a.jsx)("li",{children:"• Don't use common words or personal information"}),(0,a.jsx)("li",{children:"• Use a unique password for each account"}),(0,a.jsx)("li",{children:"• Consider using a password manager"})]})]})]})})}var es=t(9364),et=t(4951);function ea(e){let{userId:s}=e,[t,r]=(0,i.useState)([]),[l,n]=(0,i.useState)([]),[d,c]=(0,i.useState)(!0),[o,x]=(0,i.useState)(null),[m,h]=(0,i.useState)(null),[u,b]=(0,i.useState)({title:"",description:"",expected_hours:1,price_in_hours:1,status:"active"});(0,i.useEffect)(()=>{(async function(){try{c(!0),x(null);let[e,{data:t}]=await Promise.all([(0,et.Be)(s),k.O.from("user_skills").select("*, skills(name)").eq("user_id",s).eq("willing_to_teach",!0)]);r(e||[]),n(t||[])}catch(e){x("Failed to load data: "+e.message)}finally{c(!1)}})()},[s]),(0,i.useEffect)(()=>(0,et.tt)(s,r),[s]);let{requests:g,updateStatus:p,isUpdating:f}=(0,es.q)({userId:s,asProvider:!0}),j=e=>{let{name:s,value:t}=e.target,a="expected_hours"===s||"price_in_hours"===s?parseFloat(t)||0:t;b(e=>({...e,[s]:a}))},y=async e=>{if(e.preventDefault(),!u.title||u.expected_hours&&u.expected_hours<=0||u.price_in_hours&&u.price_in_hours<=0){x("Please fill required fields with valid values.");return}let t={...u},a=null;try{m?(a=await (0,et.ub)(m,u))&&r(e=>e.map(e=>e.id===m?a:e)):(a=await (0,et.RS)(t,s))&&r(e=>[a,...e]),v(),x(null)}catch(e){x("Failed to save offering: "+e.message)}},N=async e=>{confirm("Are you sure you want to delete this offering?")&&(await (0,et.u6)(e)?r(s=>s.filter(s=>s.id!==e)):x("Failed to delete offering."))},w=e=>{h(e.id),b(e)},v=()=>{b({title:"",description:"",expected_hours:1,price_in_hours:1,status:"active"}),h(null)},_=async(e,s)=>{if(confirm("Are you sure? This will ".concat("accepted"===s?"accept and charge credits":"reject"," the request.")))try{await p({requestId:e,status:s}),x(null)}catch(e){x("Failed to update status: "+e.message)}};return d?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("form",{onSubmit:y,className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:m?"Edit Offering":"Create New Service Offering"}),o&&(0,a.jsx)("p",{className:"text-red-500 mb-4",children:o}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{type:"text",name:"title",placeholder:"Service Title",value:u.title||"",onChange:j,className:"p-2 border rounded focus:ring-2 focus:ring-blue-500",required:!0}),(0,a.jsxs)("select",{name:"skill_id",value:u.skill_id||"",onChange:j,className:"p-2 border rounded focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select a Skill"}),l.map(e=>{var s;return(0,a.jsx)("option",{value:e.skill_id,children:null===(s=e.skills)||void 0===s?void 0:s.name},e.id)})]}),(0,a.jsx)("textarea",{name:"description",placeholder:"Description",value:u.description||"",onChange:j,rows:3,className:"p-2 border rounded focus:ring-2 focus:ring-blue-500 col-span-2"}),(0,a.jsx)("input",{type:"number",name:"expected_hours",placeholder:"Expected Duration (hours)",value:u.expected_hours||"",onChange:j,min:.5,step:.5,className:"p-2 border rounded focus:ring-2 focus:ring-blue-500",required:!0}),(0,a.jsx)("input",{type:"number",name:"price_in_hours",placeholder:"Price in Time Credits (hours)",value:u.price_in_hours||"",onChange:j,min:.5,step:.5,className:"p-2 border rounded focus:ring-2 focus:ring-blue-500",required:!0}),(0,a.jsxs)("select",{name:"status",value:u.status||"active",onChange:j,className:"p-2 border rounded focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"active",children:"Active"}),(0,a.jsx)("option",{value:"inactive",children:"Inactive"}),(0,a.jsx)("option",{value:"booked",children:"Booked"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:m?"Update":"Create"}),m&&(0,a.jsx)("button",{type:"button",onClick:v,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold p-4 border-b",children:["My Service Offerings (",t.length,")"]}),0===t.length?(0,a.jsx)("p",{className:"p-4 text-gray-500",children:"No offerings yet. Create one above!"}):(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:t.map(e=>{var s;return(0,a.jsxs)("li",{className:"p-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[null===(s=e.description)||void 0===s?void 0:s.substring(0,100),"... | ",e.expected_hours,"h | ",e.price_in_hours,"h credits"]}),(0,a.jsx)("span",{className:"inline-block px-2 py-1 text-xs rounded-full ".concat("active"===e.status?"bg-green-100 text-green-800":"booked"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>w(e),className:"text-blue-500 hover:text-blue-700","aria-label":"Edit offering",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>N(e.id),className:"text-red-500 hover:text-red-700","aria-label":"Delete offering",children:"Delete"})]})]},e.id)})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold p-4 border-b",children:["Incoming Requests (",g.length,")"]}),0===g.length?(0,a.jsx)("p",{className:"p-4 text-gray-500",children:"No incoming requests yet."}):(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:g.map(e=>(0,a.jsx)("li",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h4",{className:"font-medium",children:['Request for "',e.service_offerings.title,'"']}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["From: ",e.users.username," | Hours: ",e.requested_hours," | ",e.notes||"No notes"]}),(0,a.jsx)("span",{className:"inline-block px-2 py-1 text-xs rounded-full ".concat("pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status.toUpperCase()})]}),"pending"===e.status&&(0,a.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>_(e.id,"accepted"),disabled:f,className:"px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600 disabled:opacity-50",children:"Accept"}),(0,a.jsx)("button",{onClick:()=>_(e.id,"rejected"),disabled:f,className:"px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 disabled:opacity-50",children:"Reject"})]})]})},e.id))})]})]})}var er=t(9027),el=t(8202),ei=t(3766),en=t(202),ed=t(8551),ec=t(8029);async function eo(e){try{let{data:s,error:t}=await k.O.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw Error("Failed to fetch notifications: ".concat(t.message));return s||[]}catch(e){return console.error("Notifications fetch error:",e),[]}}async function ex(e){try{let{error:s}=await k.O.from("notifications").update({read:!0}).eq("id",e);if(s)throw Error("Failed to mark as read: ".concat(s.message));return!0}catch(e){return console.error("Mark as read error:",e),!1}}async function em(e){try{let{data:s}=await k.O.from("notifications").select("id").eq("user_id",e).eq("read",!1);if(!s||0===s.length)return!0;let{error:t}=await k.O.from("notifications").update({read:!0}).in("id",s.map(e=>e.id));if(t)throw Error("Failed to mark all as read: ".concat(t.message));return!0}catch(e){return console.error("Mark all as read error:",e),!1}}let eh=e=>{let{userId:s}=e,[t,r]=(0,i.useState)(!1),{notifications:l,unreadCount:n,isLoading:d,error:c,markAsRead:o,markAllAsRead:x,isMarking:m}=function(e){let s=(0,en.NL)(),{data:t=[],isLoading:a,error:r}=(0,ed.a)({queryKey:["notifications",e],queryFn:()=>eo(e),enabled:!!e,staleTime:3e5});(0,i.useEffect)(()=>{if(e)return function(e,s){let t=k.O.channel("user_notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:"user_id=eq.".concat(e)},async()=>{s(await eo(e))}).subscribe();return()=>k.O.removeChannel(t)}(e,t=>{s.setQueryData(["notifications",e],t)})},[e,s]);let l=(0,ec.D)({mutationFn:e=>ex(e),onMutate:async t=>{await s.cancelQueries({queryKey:["notifications",e]});let a=s.getQueryData(["notifications",e]);return s.setQueryData(["notifications",e],e=>null==e?void 0:e.map(e=>e.id===t?{...e,read:!0}:e)),{previousNotifications:a}},onError:(t,a,r)=>{s.setQueryData(["notifications",e],null==r?void 0:r.previousNotifications),console.error("Failed to mark as read:",t)},onSettled:()=>{s.invalidateQueries({queryKey:["notifications",e]})}}),n=(0,ec.D)({mutationFn:()=>em(e),onMutate:async()=>{await s.cancelQueries({queryKey:["notifications",e]});let t=s.getQueryData(["notifications",e]);return s.setQueryData(["notifications",e],e=>null==e?void 0:e.map(e=>({...e,read:!0}))),{previousNotifications:t}},onError:(t,a,r)=>{s.setQueryData(["notifications",e],null==r?void 0:r.previousNotifications),console.error("Failed to mark all as read:",t)},onSettled:()=>{s.invalidateQueries({queryKey:["notifications",e]})}}),d=t.filter(e=>!e.read).length;return{notifications:t,unreadCount:d,isLoading:a,error:r,markAsRead:l.mutateAsync,markAllAsRead:n.mutateAsync,isMarking:l.isPending||n.isPending}}(s),h=async e=>{e.read||await o(e.id),e.link&&window.open(e.link,"_blank"),r(!1)};return d?(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500","aria-label":"Loading notifications"})}):c?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700",onClick:()=>window.location.reload(),"aria-label":"Retry loading notifications",children:"\uD83D\uDD14"}),(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:"!"})]}):(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(er.v2,{as:"div",className:"relative inline-block text-left",children:[(0,a.jsxs)(er.v2.Button,{className:"p-2 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full",children:[(0,a.jsx)("span",{className:"sr-only",children:"Notifications"}),(0,a.jsx)("span",{"aria-label":"Notifications: ".concat(n," unread"),children:"\uD83D\uDD14"}),n>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center min-w-[20px] font-bold",children:n>99?"99+":n})]}),(0,a.jsx)(el.u,{show:t,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsxs)(er.v2.Items,{static:!0,className:"absolute right-0 mt-2 w-80 max-h-96 overflow-y-auto origin-top-right bg-white divide-y divide-gray-100 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-50",children:[(0,a.jsxs)("div",{className:"px-4 py-3 bg-gray-50",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Notifications"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[n," unread"]}),n>0&&(0,a.jsx)("button",{onClick:async()=>{await x(),r(!1)},disabled:m,className:"text-xs text-blue-600 hover:text-blue-500 disabled:opacity-50 mt-1",children:"Mark all as read"})]}),(0,a.jsx)("div",{className:"py-1",children:0===l.length?(0,a.jsx)("p",{className:"px-4 py-3 text-sm text-gray-500",children:"No notifications yet."}):l.map(e=>(0,a.jsx)(er.v2.Item,{children:s=>{let{active:t}=s;return(0,a.jsx)("button",{onClick:()=>h(e),className:"w-full text-left px-4 py-3 text-sm ".concat(t?"bg-gray-100":""," ").concat(e.read?"":"bg-blue-50 border-r-4 border-blue-500"),disabled:m,children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("span",{className:"inline-flex h-8 w-8 rounded-full ".concat("system"===e.type?"bg-gray-500":"transaction"===e.type?"bg-green-500":"service_request"===e.type?"bg-blue-500":"review"===e.type?"bg-yellow-500":"bg-purple-500"," text-white flex items-center justify-center text-xs font-medium"),children:e.type.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat(e.read?"text-gray-500":"text-gray-900"),children:e.title||"Notification"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:(0,ei.Q)(new Date(e.created_at),{addSuffix:!0})})]}),!e.read&&(0,a.jsx)("div",{className:"flex-shrink-0 ml-2",children:(0,a.jsx)("span",{className:"text-xs text-blue-500",children:"New"})})]})})}},e.id))})]})})]})})};var eu=t(6111),eb=t(2779),eg=t(3346);function ep(){let[e,s]=(0,i.useState)(null),[t,r]=(0,i.useState)([]),[l,c]=(0,i.useState)(!0),[x,m]=(0,i.useState)(""),[h,u]=(0,i.useState)(null);(0,i.useEffect)(()=>{p()},[]);let b=e=>{if("number"==typeof e)return e;if(!e)return 0;let s=Number(e);return Number.isFinite(s)?s:0},g=e=>{let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(s,"-").concat(t,"-").concat(a)},p=async()=>{try{c(!0),m("");let{data:e,error:t}=await k.O.from("users").select("id").eq("is_admin",!0).order("created_at",{ascending:!0}).limit(1).single();if(t||!e)throw Error("Admin user not found");u(e.id);let{data:a,error:l}=await k.O.from("ledger").select("hours, created_at").eq("to_user",e.id).eq("transaction_type","adjustment").ilike("note","%TimeBank%fee%").order("created_at",{ascending:!1});if(l)throw l;let i=new Date,n=new Date(i.getFullYear(),i.getMonth(),i.getDate()),d=new Date(i);d.setDate(i.getDate()-7),d.setHours(0,0,0,0);let o=new Date(i.getFullYear(),i.getMonth(),1),x=0,h=0,p=0,f=0;(a||[]).forEach(e=>{let s=(null==e?void 0:e.created_at)?new Date(e.created_at):null,t=b(null==e?void 0:e.hours);x+=t,s&&(s>=n&&(h+=t),s>=d&&(p+=t),s>=o&&(f+=t))});let j=(a||[]).length,y=j>0?x/j:0;s({totalFeesCollected:x,feesToday:h,feesThisWeek:p,feesThisMonth:f,totalFeeTransactions:j,averageFeePerTransaction:y});let N={};(a||[]).forEach(e=>{let s=(null==e?void 0:e.created_at)?new Date(e.created_at):new Date,t=g(s);N[t]||(N[t]={total:0,count:0}),N[t].total+=b(null==e?void 0:e.hours),N[t].count+=1});let w=Object.entries(N).map(e=>{let[s,t]=e;return{date:s,total_fees:t.total,transaction_count:t.count}}).sort((e,s)=>s.date.localeCompare(e.date)).slice(0,30);r(w)}catch(s){var e;console.error("Error fetching fee stats:",s),m(null!==(e=null==s?void 0:s.message)&&void 0!==e?e:"Failed to load fee statistics")}finally{c(!1)}};return l?(0,a.jsx)("div",{className:"bg-white rounded-2xl border border-gray-200 p-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading fee statistics..."})]})}):x?(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6",children:[(0,a.jsx)("p",{className:"text-red-800",children:x}),(0,a.jsxs)("button",{onClick:p,className:"mt-3 inline-flex items-center gap-2 px-3 py-1.5 bg-white border rounded-md",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),"Retry"]})]}):e?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(eu.Z,{className:"w-7 h-7 text-green-600"}),"Fee Collection Monitor"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Platform fee: ",R.TRANSFER_FEE_DISPLAY," on all transfers"]}),h&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Admin account: ",h]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("button",{onClick:p,"aria-label":"Refresh stats",className:"inline-flex items-center gap-2 px-4 py-2 bg-white border rounded-lg hover:bg-gray-50",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),"Refresh"]}),(0,a.jsxs)("button",{onClick:()=>{if(!t.length)return;let e=new Blob([[["Date","Total Fees (hours)","Transaction Count"],...t.map(e=>[e.date,e.total_fees.toFixed(2),String(e.transaction_count)])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download="timebank-fees-".concat(new Date().toISOString().split("T")[0],".csv"),a.click(),URL.revokeObjectURL(s)},disabled:!t.length,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60",children:[(0,a.jsx)(eb.Z,{className:"w-4 h-4"}),"Export CSV"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,a.jsx)("div",{className:"p-4 bg-white border rounded-2xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Total collected"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[e.totalFeesCollected.toFixed(2)," hrs"]})]}),(0,a.jsx)(eu.Z,{className:"w-6 h-6 text-green-600"})]})}),(0,a.jsx)("div",{className:"p-4 bg-white border rounded-2xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Today"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[e.feesToday.toFixed(2)," hrs"]})]}),(0,a.jsx)(eg.Z,{className:"w-6 h-6 text-blue-500"})]})}),(0,a.jsx)("div",{className:"p-4 bg-white border rounded-2xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"This week"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[e.feesThisWeek.toFixed(2)," hrs"]})]}),(0,a.jsx)(n.Z,{className:"w-6 h-6 text-indigo-500"})]})}),(0,a.jsx)("div",{className:"p-4 bg-white border rounded-2xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"This month"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[e.feesThisMonth.toFixed(2)," hrs"]})]}),(0,a.jsx)(d.Z,{className:"w-6 h-6 text-pink-500"})]})}),(0,a.jsx)("div",{className:"p-4 bg-white border rounded-2xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Transactions"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:e.totalFeeTransactions})]}),(0,a.jsx)(o.Z,{className:"w-6 h-6 text-yellow-500"})]})}),(0,a.jsx)("div",{className:"p-4 bg-white border rounded-2xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Avg / txn"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[e.averageFeePerTransaction.toFixed(2)," hrs"]})]}),(0,a.jsx)(d.Z,{className:"w-6 h-6 text-teal-500"})]})})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium",children:["Daily fees (last ",t.length," days)"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"w-full h-16",children:t.length?(0,a.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 240 40",preserveAspectRatio:"none",children:(0,a.jsx)("path",{d:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40;if(!e||0===e.length)return"";let a=e.slice().reverse().map(e=>e.total_fees),r=Math.min(...a),l=Math.max(...a)-r||1,i=s/Math.max(a.length-1,1),n=a.map((e,s)=>"".concat(s*i,",").concat(t-(e-r)/l*t));return"M".concat(n.join(" L"))}(t,240,40),fill:"none",stroke:"#2563EB",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}):(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"No fee data to display"})}),(0,a.jsx)("div",{className:"mt-3 text-sm text-gray-600",children:t.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("strong",{children:[t[0].total_fees.toFixed(2)," hrs"]})," on ",t[0].date," (most recent)"]})})]}),(0,a.jsx)("div",{className:"w-full lg:w-80 overflow-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-xs text-gray-500",children:[(0,a.jsx)("th",{className:"py-2 pr-4",children:"Date"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Total (hrs)"}),(0,a.jsx)("th",{className:"py-2",children:"Txns"})]})}),(0,a.jsx)("tbody",{children:t.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-2 pr-4",children:e.date}),(0,a.jsx)("td",{className:"py-2 pr-4",children:e.total_fees.toFixed(2)}),(0,a.jsx)("td",{className:"py-2",children:e.transaction_count})]},e.date))})]})})]})]})]}):null}var ef=t(6724),ej=t(3633),ey=t(2542),eN=t(3432),ew=t(6127),ev=t(4270),e_=t(7818),ek=t(7695),eS=t(4531),eC=t(2190);let eA={async depositCredits(e,s,t){let{data:{user:a}}=await k.O.auth.getUser();if(!a)throw Error("Not authenticated");let{data:r,error:l}=await k.O.rpc("admin_deposit_credits",{p_admin_id:a.id,p_user_id:e,p_amount:s,p_reason:t,p_ip_address:null});if(l)throw l;return r},async withdrawCredits(e,s,t){let{data:{user:a}}=await k.O.auth.getUser();if(!a)throw Error("Not authenticated");let{data:r,error:l}=await k.O.rpc("admin_withdraw_credits",{p_admin_id:a.id,p_user_id:e,p_amount:s,p_reason:t,p_ip_address:null});if(l)throw l;return r},async cancelTransaction(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:{user:a}}=await k.O.auth.getUser();if(!a)throw Error("Not authenticated");let{data:r,error:l}=await k.O.rpc("admin_cancel_transaction",{p_admin_id:a.id,p_transaction_id:e,p_reason:s,p_refund:t,p_ip_address:null});if(l)throw l;return r},async getSystemStats(){let{data:e,error:s}=await k.O.rpc("get_system_statistics");if(s)throw s;return e},async getAllUsers(e){let s=k.O.from("users").select("*").order("created_at",{ascending:!1});e&&(s=s.or("username.ilike.%".concat(e,"%,email.ilike.%").concat(e,"%")));let{data:t,error:a}=await s;if(a)throw a;return t},async getAllTransactions(e){let s=k.O.from("ledger").select("\n        *,\n        from_user_details:users!ledger_from_user_fkey(username, email, avatar_url),\n        to_user_details:users!ledger_to_user_fkey(username, email, avatar_url),\n        skill:skills(name)\n      ").order("created_at",{ascending:!1}).limit(100),{data:t,error:a}=await s;if(a)throw a;return t},async getActionLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,{data:s,error:t}=await k.O.from("admin_action_logs").select("\n        *,\n        admin:users!admin_action_logs_admin_user_id_fkey(username, email),\n        target_user:users!admin_action_logs_target_user_id_fkey(username, email)\n      ").order("created_at",{ascending:!1}).limit(e);if(t)throw t;return s},async updateUserStatus(e,s,t){let{data:{user:a}}=await k.O.auth.getUser();if(!a)throw Error("Not authenticated");let{data:r,error:l}=await k.O.from("users").update({is_active:s,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(l)throw l;let{error:i}=await k.O.from("admin_action_logs").insert({admin_user_id:a.id,action_type:s?"user_activate":"user_suspend",target_user_id:e,reason:t});if(i)throw i;return r},async updateUserRole(e,s,t){let{data:{user:a}}=await k.O.auth.getUser();if(!a)throw Error("Not authenticated");let{data:r,error:l}=await k.O.from("users").update({role:s,is_admin:"admin"===s,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(l)throw l;let{error:i}=await k.O.from("admin_action_logs").insert({admin_user_id:a.id,action_type:"role_change",target_user_id:e,reason:t,metadata:{new_role:s}});if(i)throw i;return r}};function eE(){var e,s;let[t,r]=(0,i.useState)("overview"),[l,x]=(0,i.useState)([]),[m,u]=(0,i.useState)([]),[b,g]=(0,i.useState)(null),[p,j]=(0,i.useState)([]),[y,N]=(0,i.useState)(!0),[w,v]=(0,i.useState)(""),[_,k]=(0,i.useState)(null),[C,A]=(0,i.useState)(null),[E,T]=(0,i.useState)(!1),[D,Z]=(0,i.useState)(!1),[R,L]=(0,i.useState)(!1),[O,M]=(0,i.useState)(null),[P,q]=(0,i.useState)({amount:"",reason:""}),[U,I]=(0,i.useState)({amount:"",reason:""}),[B,z]=(0,i.useState)(!1);(0,i.useEffect)(()=>{Y()},[t]);let Y=async()=>{N(!0),k(null);try{if("overview"===t){let e=await eA.getSystemStats();g(e)}else if("users"===t){let e=await eA.getAllUsers(w);x(e||[])}else if("transactions"===t){let e=await eA.getAllTransactions();u(e||[])}else if("logs"===t){let e=await eA.getActionLogs();j(e||[])}}catch(e){console.error("Error loading data:",e),k(e.message||"Failed to load data")}finally{N(!1)}},Q=async()=>{if(C&&P.amount&&P.reason){z(!0);try{await eA.depositCredits(C.id,parseFloat(P.amount),P.reason),alert("Successfully deposited ".concat(P.amount," hours to ").concat(C.username)),T(!1),q({amount:"",reason:""}),Y()}catch(e){console.error("Deposit error:",e),alert("Failed to deposit credits: "+e.message)}finally{z(!1)}}},H=async()=>{if(C&&U.amount&&U.reason){z(!0);try{await eA.withdrawCredits(C.id,parseFloat(U.amount),U.reason),alert("Successfully withdrew ".concat(U.amount," hours from ").concat(C.username)),Z(!1),I({amount:"",reason:""}),Y()}catch(e){console.error("Withdraw error:",e),alert("Failed to withdraw credits: "+e.message)}finally{z(!1)}}},W=async()=>{if(O){z(!0);try{await eA.cancelTransaction(O.id,"Admin cancelled transaction",!0),alert("Successfully cancelled transaction"),L(!1),Y()}catch(e){console.error("Cancel error:",e),alert("Failed to cancel transaction: "+e.message)}finally{z(!1)}}},K=()=>{Y()},V=l.filter(e=>e.username.toLowerCase().includes(w.toLowerCase())||e.email.toLowerCase().includes(w.toLowerCase())),G=m.filter(e=>{var s,t;let a=(null===(s=e.from_user_details)||void 0===s?void 0:s.username)||"",r=(null===(t=e.to_user_details)||void 0===t?void 0:t.username)||"",l=e.note||"",i=w.toLowerCase();return a.toLowerCase().includes(i)||r.toLowerCase().includes(i)||l.toLowerCase().includes(i)});return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-gray-50 to-blue-50",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-red-600 via-orange-600 to-amber-600 text-white shadow-xl",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"w-9 h-9 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-black",children:"Admin Control Panel"}),(0,a.jsx)("p",{className:"text-red-100 text-sm mt-1",children:"System Management & Bank Operations"})]})]}),(0,a.jsxs)("button",{onClick:Y,disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl transition-colors disabled:opacity-50",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 ".concat(y?"animate-spin":"")}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Refresh"})]})]}),(0,a.jsx)("nav",{className:"flex gap-2 mt-6 overflow-x-auto pb-2",children:[{key:"overview",label:"Overview",icon:ej.Z},{key:"users",label:"Users",icon:h.Z},{key:"transactions",label:"Transactions",icon:o.Z},{key:"bank",label:"Bank Operations",icon:eu.Z},{key:"logs",label:"Action Logs",icon:n.Z}].map(e=>{let{key:s,label:l,icon:i}=e;return(0,a.jsxs)("button",{onClick:()=>r(s),className:"flex items-center gap-2 px-5 py-3 rounded-xl font-semibold text-sm transition-all whitespace-nowrap ".concat(t===s?"bg-white text-red-600 shadow-lg":"bg-white/10 text-white hover:bg-white/20"),children:[(0,a.jsx)(i,{className:"w-4 h-4"}),l]},s)})})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[_&&(0,a.jsxs)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[(0,a.jsx)(ey.Z,{className:"w-5 h-5 text-red-600"}),(0,a.jsx)("p",{className:"text-red-800",children:_})]}),y&&(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(eN.Z,{className:"w-8 h-8 text-blue-600 animate-spin"})}),!y&&(0,a.jsxs)(a.Fragment,{children:["overview"===t&&b&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null===(e=b.total_users)||void 0===e?void 0:e.toLocaleString())||0})]})]}),(0,a.jsxs)("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"w-3 h-3"}),b.active_users||0," active"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-emerald-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Transactions"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(null===(s=b.total_transactions)||void 0===s?void 0:s.toLocaleString())||0})]})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:[b.completed_transactions||0," completed"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Hours Circulated"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:parseFloat(b.total_hours_circulated||0).toLocaleString()})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Total exchanged"})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-red-500 to-orange-600 rounded-xl p-6 text-white shadow-lg hover:shadow-xl transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:(0,a.jsx)(ey.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-red-100",children:"Pending"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white",children:b.pending_transactions||0})]})]}),(0,a.jsx)("p",{className:"text-xs text-red-100",children:"Requires attention"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-8",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-6 h-6 text-blue-600"}),"System Balance Overview"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Total System Balance"}),(0,a.jsx)("p",{className:"text-4xl font-bold text-gray-900 mb-1",children:parseFloat(b.total_system_balance||0).toFixed(2)}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"hours in circulation"})]}),(0,a.jsxs)("div",{className:"p-6 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl border border-emerald-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Average User Balance"}),(0,a.jsx)("p",{className:"text-4xl font-bold text-gray-900 mb-1",children:parseFloat(b.avg_user_balance||0).toFixed(2)}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"hours per active user"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Service Offerings"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:b.total_service_offerings||0}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[b.active_service_offerings||0," active"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Verified Users"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:b.verified_users||0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"ID verified members"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Average Rating"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:parseFloat(b.avg_user_rating||0).toFixed(2)}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Community score"})]})]})]}),"users"===t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(ew.Z,{className:"w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search users by username or email...",value:w,onChange:e=>v(e.target.value),onKeyDown:e=>"Enter"===e.key&&K(),className:"flex-1 outline-none text-gray-900"}),(0,a.jsx)("button",{onClick:K,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold",children:"Search"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Balance"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:0===V.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"No users found"})}):V.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white font-bold",children:e.username.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.username}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.role})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.email}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsx)("span",{className:"font-bold text-gray-900",children:e.time_balance}),(0,a.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"hrs"})]}),(0,a.jsx)("td",{className:"px-6 py-4",children:e.is_active?(0,a.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full",children:"Active"}):(0,a.jsx)("span",{className:"px-3 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full",children:"Inactive"})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{A(e),T(!0)},className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors",title:"Deposit",children:(0,a.jsx)(ev.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{A(e),Z(!0)},className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"Withdraw",children:(0,a.jsx)(e_.Z,{className:"w-4 h-4"})})]})})]},e.id))})]})})})]}),"transactions"===t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(ew.Z,{className:"w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search transactions...",value:w,onChange:e=>v(e.target.value),className:"flex-1 outline-none text-gray-900"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"ID"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"From"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"To"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Hours"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:0===G.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"px-6 py-8 text-center text-gray-500",children:"No transactions found"})}):G.map(e=>{var s,t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("td",{className:"px-6 py-4 text-sm font-mono text-gray-600",children:[e.id.substring(0,8),"..."]}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:(null===(s=e.from_user_details)||void 0===s?void 0:s.username)||"Unknown"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:(null===(t=e.to_user_details)||void 0===t?void 0:t.username)||"Unknown"}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsx)("span",{className:"font-bold text-gray-900",children:e.hours}),(0,a.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"hrs"})]}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded",children:e.transaction_type})}),(0,a.jsxs)("td",{className:"px-6 py-4",children:["completed"===e.status&&(0,a.jsxs)("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full flex items-center gap-1 w-fit",children:[(0,a.jsx)(F.Z,{className:"w-3 h-3"}),"Completed"]}),"pending"===e.status&&(0,a.jsxs)("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-700 text-xs font-semibold rounded-full flex items-center gap-1 w-fit",children:[(0,a.jsx)(n.Z,{className:"w-3 h-3"}),"Pending"]}),"disputed"===e.status&&(0,a.jsxs)("span",{className:"px-3 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full flex items-center gap-1 w-fit",children:[(0,a.jsx)(ey.Z,{className:"w-3 h-3"}),"Disputed"]}),"cancelled"===e.status&&(0,a.jsxs)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full flex items-center gap-1 w-fit",children:[(0,a.jsx)(ek.Z,{className:"w-3 h-3"}),"Cancelled"]})]}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4",children:"cancelled"!==e.status&&(0,a.jsx)("button",{onClick:()=>{M(e),L(!0)},className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"Cancel Transaction",children:(0,a.jsx)(ek.Z,{className:"w-4 h-4"})})})]},e.id)})})]})})})]}),"bank"===t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 p-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:(0,a.jsx)(eS.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Deposit Credits"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Add time to user accounts"})]})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:"Select a user from the Users tab to deposit time credits. All deposits are logged and audited."}),(0,a.jsx)("button",{onClick:()=>r("users"),className:"w-full bg-green-600 text-white font-semibold py-3 rounded-xl hover:bg-green-700 transition-colors",children:"Go to Users"})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 rounded-xl border-2 border-red-200 p-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-600 rounded-xl flex items-center justify-center",children:(0,a.jsx)(c.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Withdraw Credits"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Remove time from user accounts"})]})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:"Select a user from the Users tab to withdraw time credits. Requires sufficient balance and reason."}),(0,a.jsx)("button",{onClick:()=>r("users"),className:"w-full bg-red-600 text-white font-semibold py-3 rounded-xl hover:bg-red-700 transition-colors",children:"Go to Users"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Transaction Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Cancel or modify transactions"})]})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:"View and manage all transactions in the system. Cancel disputed transactions or apply refunds."}),(0,a.jsx)("button",{onClick:()=>r("transactions"),className:"bg-blue-600 text-white font-semibold px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors",children:"View All Transactions"})]})]}),"logs"===t&&(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Admin Action Logs"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Complete audit trail of all administrative actions"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Admin"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Action"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Target User"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Reason"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:0===p.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No action logs found"})}):p.map(e=>{var s,t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(e.created_at).toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:(null===(s=e.admin)||void 0===s?void 0:s.username)||"Unknown"}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded",children:e.action_type})}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:(null===(t=e.target_user)||void 0===t?void 0:t.username)||"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.amount?"".concat(e.amount," hrs"):"-"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600 max-w-xs truncate",children:e.reason})]},e.id)})})]})})]})})]})]}),E&&C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(ev.Z,{className:"w-6 h-6 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Deposit Credits"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Add time to ",C.username]})]})]}),(0,a.jsx)("button",{onClick:()=>T(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(eC.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Amount (hours)"}),(0,a.jsx)("input",{type:"number",step:"0.5",min:"0",value:P.amount,onChange:e=>q({...P,amount:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none",placeholder:"Enter hours to deposit"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reason (required)"}),(0,a.jsx)("textarea",{value:P.reason,onChange:e=>q({...P,reason:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none resize-none",rows:3,placeholder:"Explain why you're depositing credits..."})]}),(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:(0,a.jsxs)("p",{className:"text-sm text-green-800",children:[(0,a.jsx)("strong",{children:"Current Balance:"})," ",C.time_balance," hours",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"New Balance:"})," ",(parseFloat(C.time_balance.toString())+parseFloat(P.amount||"0")).toFixed(2)," hours"]})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>T(!1),disabled:B,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:Q,disabled:!P.amount||!P.reason||B,className:"flex-1 px-6 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eN.Z,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):"Deposit Credits"})]})]})]})}),D&&C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(e_.Z,{className:"w-6 h-6 text-red-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Withdraw Credits"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Remove time from ",C.username]})]})]}),(0,a.jsx)("button",{onClick:()=>Z(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(eC.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Amount (hours)"}),(0,a.jsx)("input",{type:"number",step:"0.5",min:"0",max:C.time_balance,value:U.amount,onChange:e=>I({...U,amount:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none",placeholder:"Enter hours to withdraw"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Reason (required)"}),(0,a.jsx)("textarea",{value:U.reason,onChange:e=>I({...U,reason:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none resize-none",rows:3,placeholder:"Explain why you're withdrawing credits..."})]}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,a.jsxs)("p",{className:"text-sm text-red-800",children:[(0,a.jsx)("strong",{children:"Current Balance:"})," ",C.time_balance," hours",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"New Balance:"})," ",(parseFloat(C.time_balance.toString())-parseFloat(U.amount||"0")).toFixed(2)," hours"]})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>Z(!1),disabled:B,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:H,disabled:!U.amount||!U.reason||parseFloat(U.amount)>C.time_balance||B,className:"flex-1 px-6 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eN.Z,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):"Withdraw Credits"})]})]})]})}),R&&O&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(ey.Z,{className:"w-6 h-6 text-orange-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Cancel Transaction"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",O.id.substring(0,8),"..."]})]})]}),(0,a.jsx)("button",{onClick:()=>L(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(eC.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:[(0,a.jsx)("p",{className:"text-sm text-orange-800 font-medium",children:"Are you sure you want to cancel this transaction? This action will:"}),(0,a.jsxs)("ul",{className:"mt-2 space-y-1 text-sm text-orange-700 ml-4",children:[(0,a.jsxs)("li",{children:["• Reverse ",O.hours," hours"]}),(0,a.jsx)("li",{children:"• Notify both users"}),(0,a.jsx)("li",{children:"• Create an audit log entry"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>L(!1),disabled:B,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Keep Transaction"}),(0,a.jsx)("button",{onClick:W,disabled:B,className:"flex-1 px-6 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eN.Z,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):"Cancel Transaction"})]})]})})]})}function eF(e){let{user:s,onSignOut:t}=e,{activeTab:r,setActiveTab:w}=function(e){let[s,t]=(0,i.useState)(e);return{activeTab:s,setActiveTab:t}}("overview"),[v,_]=(0,i.useState)(!1),k=(0,i.useMemo)(()=>{switch(r){case"overview":return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 group",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-11 h-11 bg-blue-50 rounded-lg flex items-center justify-center group-hover:bg-blue-100 transition-colors",children:(0,a.jsx)(n.Z,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsx)("span",{className:"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full",children:"Active"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 font-medium mb-1",children:"Time Balance"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Check Balance"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"See your available hours"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 group",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-11 h-11 bg-emerald-50 rounded-lg flex items-center justify-center group-hover:bg-emerald-100 transition-colors",children:(0,a.jsx)(d.Z,{className:"w-6 h-6 text-emerald-600"})}),(0,a.jsx)(c.Z,{className:"w-4 h-4 text-emerald-600"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 font-medium mb-1",children:"Services Offered"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Manage"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Your service catalog"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 group",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-11 h-11 bg-purple-50 rounded-lg flex items-center justify-center group-hover:bg-purple-100 transition-colors",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsx)("span",{className:"text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full",children:"Live"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 font-medium mb-1",children:"Recent Activity"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:"View All"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Latest transactions"})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl p-5 hover:shadow-xl transition-all duration-300 hover:-translate-y-1 group cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-11 h-11 bg-white/20 backdrop-blur rounded-lg flex items-center justify-center group-hover:bg-white/30 transition-colors",children:(0,a.jsx)(x.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsx)(m.Z,{className:"w-5 h-5 text-yellow-300"})]}),(0,a.jsx)("p",{className:"text-sm text-blue-100 font-medium mb-1",children:"Marketplace"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white mb-1",children:"Explore"}),(0,a.jsx)("p",{className:"text-xs text-blue-200",children:"Find services now"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"xl:col-span-2 space-y-6",children:[(0,a.jsxs)("section",{"aria-labelledby":"balance-heading",className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl blur-xl opacity-20"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(A,{userId:s.id})})]}),(0,a.jsxs)("section",{"aria-labelledby":"transactions-heading",className:"bg-white rounded-2xl border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-white border-b border-gray-100 px-6 py-5",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-sm",children:(0,a.jsx)(o.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{id:"transactions-heading",className:"text-lg font-bold text-gray-900",children:"Recent Activity"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Your latest time exchanges"})]})]}),(0,a.jsxs)("button",{onClick:()=>w("transactions"),className:"text-sm font-semibold text-blue-600 hover:text-blue-700 flex items-center gap-1 transition-colors group",children:["View All",(0,a.jsx)(c.Z,{className:"w-4 h-4 group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-transform"})]})]})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(q,{userId:s.id})})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("section",{"aria-labelledby":"transfer-heading",className:"relative group",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-400 to-purple-500 rounded-2xl blur-lg opacity-0 group-hover:opacity-30 transition-opacity duration-500"}),(0,a.jsxs)("div",{className:"relative bg-white rounded-2xl border-2 border-gray-200 overflow-hidden hover:border-blue-300 transition-all duration-300",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 px-5 py-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-sm",children:(0,a.jsx)(m.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900",children:"Quick Transfer"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Send time in seconds"})]}),(0,a.jsx)("div",{className:"p-5",children:(0,a.jsx)(P,{userId:s.id})})]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 rounded-2xl border border-blue-100 p-6 hover:shadow-lg transition-shadow duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-5",children:[(0,a.jsx)("div",{className:"w-9 h-9 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-sm",children:(0,a.jsx)(h.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-gray-900",children:"Community Pulse"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Live marketplace stats"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/80 backdrop-blur rounded-xl border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"w-4 h-4 text-emerald-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Active Members"})]}),(0,a.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"1.2K+"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/80 backdrop-blur rounded-xl border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Hours Traded"})]}),(0,a.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"5.6K"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/80 backdrop-blur rounded-xl border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(u.Z,{className:"w-4 h-4 text-purple-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Avg. Rating"})]}),(0,a.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"4.8"})]})]}),(0,a.jsxs)("button",{onClick:()=>w("marketplace"),className:"w-full mt-5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md flex items-center justify-center gap-2 group",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),"Explore Marketplace",(0,a.jsx)(c.Z,{className:"w-4 h-4 group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-transform"})]})]})]})]})]});case"profile":return(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Your Profile"}),(0,a.jsx)("p",{className:"text-blue-100 text-sm",children:"Manage your personal information"})]})]})}),(0,a.jsx)("section",{className:"p-8","aria-labelledby":"profile-heading",children:(0,a.jsx)(W,{userId:s.id})})]})});case"skills":return(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Skills & Expertise"}),(0,a.jsx)("p",{className:"text-purple-100 text-sm",children:"Showcase your talents to the community"})]})]})}),(0,a.jsx)("section",{className:"p-8","aria-labelledby":"skills-heading",children:(0,a.jsx)(Y,{userId:s.id})})]})});case"transactions":return(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:(0,a.jsx)(g.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{id:"all-transactions-heading",className:"text-2xl font-bold text-white",children:"Transaction History"}),(0,a.jsx)("p",{className:"text-emerald-100 text-sm",children:"Complete record of all time exchanges"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-emerald-100 text-xs",children:"Total Volume"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white",children:"View Stats"})]})]})}),(0,a.jsx)("section",{className:"p-8","aria-labelledby":"all-transactions-heading",children:(0,a.jsx)(q,{userId:s.id})})]})});case"services":return(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 to-blue-700 px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Service Management"}),(0,a.jsx)("p",{className:"text-indigo-100 text-sm",children:"Create and manage your service offerings"})]})]})}),(0,a.jsx)("section",{className:"p-8","aria-labelledby":"services-heading",children:(0,a.jsx)(ea,{userId:s.id})})]})});case"marketplace":return(0,a.jsx)("section",{className:"w-full","aria-labelledby":"marketplace-heading",children:(0,a.jsx)(ef.default,{})});case"security":return(0,a.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-red-600 to-orange-600 px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Security Settings"}),(0,a.jsx)("p",{className:"text-red-100 text-sm",children:"Protect your account and data"})]})]})}),(0,a.jsx)("section",{className:"p-8","aria-labelledby":"security-heading",children:(0,a.jsx)(ee,{})})]})});case"admin":return s.is_admin?(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("section",{className:"w-full","aria-labelledby":"admin-heading",children:(0,a.jsx)(eE,{})}),(0,a.jsx)("section",{className:"w-full","aria-labelledby":"admin-heading",children:(0,a.jsx)(ep,{})})]}):null;default:return null}},[r,s.id,w,s.is_admin]),S=[{key:"overview",label:"Overview",icon:n.Z,color:"blue"},{key:"marketplace",label:"Marketplace",icon:x.Z,color:"indigo"},{key:"services",label:"My Services",icon:p.Z,color:"purple"},{key:"skills",label:"Skills",icon:b.Z,color:"pink"},{key:"transactions",label:"History",icon:g.Z,color:"emerald"},{key:"profile",label:"Profile",icon:h.Z,color:"cyan"},{key:"security",label:"Security",icon:f.Z,color:"red"},...s.is_admin?[{key:"admin",label:"Admin",icon:j.Z,color:"orange"}]:[]];return(0,a.jsxs)("div",{className:"jsx-83037452c623c470 min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/50 to-indigo-50/30",children:[(0,a.jsx)("div",{className:"jsx-83037452c623c470 sticky top-0 z-50 backdrop-blur-xl bg-white/80 border-b border-gray-200 shadow-sm",children:(0,a.jsxs)("div",{className:"jsx-83037452c623c470 container mx-auto px-4 sm:px-6 lg:px-8 max-w-[1600px]",children:[(0,a.jsx)("header",{className:"jsx-83037452c623c470 py-4",children:(0,a.jsxs)("div",{className:"jsx-83037452c623c470 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"jsx-83037452c623c470 flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"jsx-83037452c623c470 relative group",children:[(0,a.jsx)("div",{className:"jsx-83037452c623c470 absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl blur-lg opacity-50 group-hover:opacity-75 transition-opacity"}),(0,a.jsx)("div",{className:"jsx-83037452c623c470 relative w-12 h-12 bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-xl",children:(0,a.jsx)(n.Z,{className:"w-7 h-7 text-white"})})]}),(0,a.jsxs)("div",{className:"jsx-83037452c623c470",children:[(0,a.jsx)("h1",{className:"jsx-83037452c623c470 text-2xl font-black bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"TimeSwap"}),(0,a.jsx)("p",{className:"jsx-83037452c623c470 text-xs text-gray-600 font-medium",children:"Time-Based Service Exchange"})]})]}),(0,a.jsxs)("div",{className:"jsx-83037452c623c470 flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"jsx-83037452c623c470 relative",children:[(0,a.jsxs)("button",{onClick:()=>_(!v),className:"jsx-83037452c623c470 hidden md:flex items-center gap-3 px-4 py-2 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border border-gray-200 hover:shadow-md transition-all",children:[(0,a.jsx)("div",{className:"jsx-83037452c623c470 w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:s.username.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"jsx-83037452c623c470 text-left",children:[(0,a.jsx)("p",{className:"jsx-83037452c623c470 text-sm font-bold text-gray-900",children:s.username}),(0,a.jsx)("p",{className:"jsx-83037452c623c470 text-xs text-gray-600",children:s.is_admin?"Admin":"Member"})]}),(0,a.jsx)(y.Z,{className:"w-4 h-4 text-gray-600 transition-transform ".concat(v?"rotate-180":"")})]}),v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:()=>_(!1),className:"jsx-83037452c623c470 fixed inset-0 z-40"}),(0,a.jsxs)("div",{className:"jsx-83037452c623c470 absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-200 py-2 z-50",children:[(0,a.jsxs)("div",{className:"jsx-83037452c623c470 px-4 py-3 border-b border-gray-100",children:[(0,a.jsx)("p",{className:"jsx-83037452c623c470 text-sm font-bold text-gray-900",children:s.username}),(0,a.jsx)("p",{className:"jsx-83037452c623c470 text-xs text-gray-600",children:s.email})]}),(0,a.jsxs)("button",{onClick:()=>{_(!1),t()},className:"jsx-83037452c623c470 w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-red-50 transition-colors text-red-600 font-medium",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4"}),"Sign Out"]})]})]})]}),(0,a.jsx)(eh,{userId:s.id})]})]})}),(0,a.jsx)("nav",{role:"tablist","aria-label":"Dashboard tabs",className:"jsx-83037452c623c470 pb-0 -mb-px",children:(0,a.jsx)("div",{role:"tablist",className:"jsx-83037452c623c470 flex gap-1 overflow-x-auto scrollbar-hide",children:S.map(e=>{let{key:s,label:t,icon:l}=e;return(0,a.jsxs)("button",{onClick:()=>w(s),role:"tab","aria-selected":r===s,"aria-controls":"tabpanel-".concat(s),id:"tab-".concat(s),className:"jsx-83037452c623c470 "+"\n                    relative px-5 py-3 font-semibold text-sm transition-all whitespace-nowrap\n                    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-t-xl\n                    flex items-center gap-2\n                    ".concat(r===s?"text-blue-600 bg-white border-t-2 border-x-2 border-blue-600 -mb-[2px]":"text-gray-600 hover:text-gray-900 hover:bg-gray-50/50","\n                  "),children:[(0,a.jsx)(l,{className:"jsx-83037452c623c470 w-4 h-4"}),(0,a.jsx)("span",{className:"jsx-83037452c623c470 hidden sm:inline",children:t}),r===s&&(0,a.jsx)("div",{className:"jsx-83037452c623c470 absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-600 to-indigo-600"})]},s)})})})]})}),(0,a.jsx)("div",{className:"jsx-83037452c623c470 container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-[1600px]",children:(0,a.jsx)("main",{role:"tabpanel",id:"tabpanel-".concat(r),"aria-labelledby":"tab-".concat(r),className:"jsx-83037452c623c470",children:k})}),(0,a.jsx)(l(),{id:"83037452c623c470",children:".scrollbar-hide.jsx-83037452c623c470::-webkit-scrollbar{display:none}.scrollbar-hide.jsx-83037452c623c470{-ms-overflow-style:none;scrollbar-width:none}"})]})}function eT(){let{user:e,loading:s,logout:t}=(0,w.a)(),r=async()=>{try{await t(),window.location.href="/"}catch(e){console.error("Sign out error:",e)}};return s?(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/50 to-indigo-50/30","aria-label":"Loading dashboard",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"relative w-20 h-20 mx-auto mb-8",children:[(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-blue-100 rounded-full"}),(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-blue-900 rounded-full animate-spin border-t-transparent",role:"status"}),(0,a.jsx)("div",{className:"absolute inset-3 bg-gradient-to-br from-blue-900 to-indigo-900 rounded-full flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"w-8 h-8 text-white animate-pulse"})})]}),(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Loading TimeSwap"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Preparing your dashboard..."}),(0,a.jsx)("p",{className:"sr-only",children:"Loading..."})]})}):(0,a.jsx)(_,{children:e?(0,a.jsx)(eF,{user:e,onSignOut:r}):null})}}},function(e){e.O(0,[342,543,83,733,724,888,774,179],function(){return e(e.s=6117)}),_N_E=e.O()}]);