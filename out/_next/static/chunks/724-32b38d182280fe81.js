"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{6781:function(e,r,t){t.d(r,{a:function(){return o}});var s=t(7294),a=t(1163),n=t(9263);let i={user:null,loading:!0,error:null},l=async e=>{let{data:r,error:t}=await n.O.from("users").select("*").eq("id",e).single();if(t){if("PGRST116"===t.code)return null;throw Error("Failed to fetch user: ".concat(t.message))}return r},o=()=>{let[e,r]=(0,s.useState)(i),t=(0,a.useRouter)();(0,s.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:t},error:s}=await n.O.auth.getSession();if(!e)return;if(s){r({user:null,loading:!1,error:s.message});return}if(null==t?void 0:t.user){let s=await l(t.user.id);if(!e)return;s?r({user:s,loading:!1,error:null}):r({user:null,loading:!0,error:null})}else r({user:null,loading:!1,error:null})}catch(t){if(!e)return;r({user:null,loading:!1,error:t instanceof Error?t.message:"Authentication failed"})}})();let{data:{subscription:s}}=n.O.auth.onAuthStateChange(async(s,a)=>{if(e){if("SIGNED_IN"===s&&(null==a?void 0:a.user))try{await new Promise(e=>setTimeout(e,500));let t=await l(a.user.id);t?r({user:t,loading:!1,error:null}):setTimeout(async()=>{let t=await l(a.user.id);t&&e&&r({user:t,loading:!1,error:null})},1e3)}catch(e){r({user:null,loading:!1,error:e instanceof Error?e.message:"User setup failed"})}else"SIGNED_OUT"===s?r({user:null,loading:!1,error:null}):"PASSWORD_RECOVERY"===s&&t.push("/reset-password")}});return()=>{e=!1,s.unsubscribe()}},[t]);let o=async(e,t)=>{try{r(e=>({...e,loading:!0,error:null}));let{data:s,error:a}=await n.O.auth.signInWithPassword({email:e,password:t});if(a){let e=a.message||"Sign in failed";return r(r=>({...r,loading:!1,error:e})),{success:!1,error:e}}if(!s.user)return r(e=>({...e,loading:!1,error:"Sign in failed - no user data"})),{success:!1,error:"Sign in failed - no user data"};return{success:!0,error:null}}catch(t){let e=t instanceof Error?t.message:"Sign in failed";return r(r=>({...r,loading:!1,error:e})),{success:!1,error:e}}},c=async(e,t,s,a,i,l)=>{try{r(e=>({...e,loading:!0,error:null}));let{data:o,error:c}=await n.O.auth.signUp({email:e,password:t,options:{data:{username:s,bio:a,phone:i,location:l}}});if(c){let e=c.message||"Sign up failed";return r(r=>({...r,loading:!1,error:e})),{success:!1,error:e}}if(!o.user)return r(e=>({...e,loading:!1,error:"Sign up failed"})),{success:!1,error:"Sign up failed"};return{success:!0,error:null}}catch(t){let e=t instanceof Error?t.message:"Sign up failed";return r(r=>({...r,loading:!1,error:e})),{success:!1,error:e}}},u=async()=>{try{r(e=>({...e,loading:!0}));let{error:e}=await n.O.auth.signOut();if(e){let t=e.message||"Sign out failed";return r(e=>({...e,loading:!1,error:t})),{success:!1,error:t}}return r({user:null,loading:!1,error:null}),t.push("/"),{success:!0,error:null}}catch(t){let e=t instanceof Error?t.message:"Sign out failed";return r(r=>({...r,loading:!1,error:e})),{success:!1,error:e}}},d=async e=>{try{let{data:{user:r},error:t}=await n.O.auth.getUser();if(t||!r)return{success:!1,error:"Not authenticated"};let{error:s}=await n.O.auth.updateUser({password:e});if(s)return{success:!1,error:s.message};return{success:!0,error:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Password update failed"}}},f=async e=>{try{let{error:r}=await n.O.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(r)return{success:!1,error:r.message};return{success:!0,error:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Password reset failed"}}};return{user:e.user,loading:e.loading,error:e.error,signIn:o,signUp:c,signOut:u,logout:u,updatePassword:d,resetPassword:f}}},9364:function(e,r,t){t.d(r,{q:function(){return d}});var s=t(202),a=t(8551),n=t(8029),i=t(9263);async function l(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2?arguments[2]:void 0;try{let s=i.O.from("service_requests").select("\n        *,\n        service_offerings!inner(title, description, price_in_hours, user_id),\n        users!requester_user_id_fkey(username, avatar_url)\n      ").eq(r?"service_offerings.user_id":"requester_user_id",e).order("created_at",{ascending:!1});t&&(s=s.eq("service_offering_id",t));let{data:a,error:n}=await s;if(n)throw Error("Failed to fetch requests: ".concat(n.message));return a||[]}catch(e){return console.error("Service requests fetch error:",e),[]}}async function o(e){try{let{data:r,error:t}=await i.O.from("service_requests").insert(e).select().single();if(t)throw Error("Failed to create request: ".concat(t.message));return r}catch(e){return console.error("Create request error:",e),null}}async function c(e,r){try{let{data:t,error:s}=await i.O.from("service_requests").update({status:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw Error("Failed to update request: ".concat(s.message));return t}catch(e){return console.error("Update request status error:",e),null}}var u=t(7294);function d(e){let{userId:r,asProvider:t=!1,offeringId:d}=e,f=(0,s.NL)(),{data:g,isLoading:h,error:m}=(0,a.a)({queryKey:["serviceRequests",{userId:r,asProvider:t,offeringId:d}],queryFn:()=>l(r,t,d),enabled:!!r});(0,u.useEffect)(()=>{if(r)return function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2?arguments[2]:void 0,s=i.O.channel("user_requests").on("postgres_changes",{event:"*",schema:"public",table:"service_requests",filter:r?"service_offerings.user_id=eq.".concat(e):"requester_user_id=eq.".concat(e)},async()=>{t(await l(e,r))}).subscribe();return()=>i.O.removeChannel(s)}(r,t,e=>{f.setQueryData(["serviceRequests",{userId:r,asProvider:t,offeringId:d}],e)})},[r,t,d,f]);let v=(0,n.D)({mutationFn:e=>o(e),onSuccess:()=>{f.invalidateQueries({queryKey:["serviceRequests"]})}}),x=(0,n.D)({mutationFn:e=>{let{requestId:r,status:t}=e;return c(r,t)},onSuccess:()=>{f.invalidateQueries({queryKey:["serviceRequests"]})}});return{requests:g||[],isLoading:h,error:m,createRequest:v.mutateAsync,updateStatus:x.mutateAsync,isCreating:v.isPending,isUpdating:x.isPending}}},9263:function(e,r,t){t.d(r,{O:function(){return i}});var s=t(1543);let a="https://eokrnauyrkhbgzzamnfk.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVva3JuYXV5cmtoYmd6emFtbmZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MDAzMTEsImV4cCI6MjA3NTA3NjMxMX0.QquyljjO3mJ17s5RlQhbuUgaJB3AGkU9kzBn-UXtX_4";if(!a||!n)throw Error("Missing Supabase environment variables");let i=(0,s.eI)(a,n)},6724:function(e,r,t){t.r(r),t.d(r,{default:function(){return h}});var s=t(5893),a=t(7294),n=t(9726),i=t(4951),l=t(6781),o=t(8202),c=t(2961),u=t(9364);function d(e){let{isOpen:r,onClose:t,offering:n,onSuccess:i}=e,{user:d}=(0,l.a)(),{createRequest:f,isCreating:g}=(0,u.q)({userId:null==d?void 0:d.id}),[h,m]=(0,a.useState)(""),[v,x]=(0,a.useState)(n.expected_hours),[p,y]=(0,a.useState)(null),b=async e=>{if(e.preventDefault(),d){if(v<=0){y("Requested hours must be greater than 0.");return}y(null);try{await f({service_offering_id:n.id,requester_user_id:d.id,requested_hours:v,notes:h,status:"pending"}),null==i||i(),t()}catch(e){y("Failed to submit request: "+e.message)}}};return(0,s.jsx)(o.u,{appear:!0,show:r,as:"div",children:(0,s.jsxs)(c.Vq,{as:"div",className:"relative z-50",onClose:t,children:[(0,s.jsx)(o.u.Child,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsx)(o.u.Child,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,s.jsxs)(c.Vq.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 shadow-xl align-middle",children:[(0,s.jsxs)(c.Vq.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:["Request ",n.title]}),(0,s.jsxs)("form",{onSubmit:b,className:"mt-4 space-y-4",children:[p&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:p}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"hours",className:"block text-sm font-medium text-gray-700",children:"Requested Hours"}),(0,s.jsx)("input",{id:"hours",type:"number",value:v,onChange:e=>x(parseFloat(e.target.value)||0),min:.5,step:.5,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0,disabled:g})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes (optional)"}),(0,s.jsx)("textarea",{id:"notes",value:h,onChange:e=>m(e.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",disabled:g})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:g,children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",disabled:g,children:g?"Submitting...":"Send Request"})]})]})]})})})})]})})}function f(e){let{offering:r,onRequest:t}=e,{user:n}=(0,l.a)(),[i,o]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:r.title}),(0,s.jsx)("p",{className:"text-gray-600 mb-3 line-clamp-2",children:r.description}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[(0,s.jsxs)("span",{children:["Duration: ",r.expected_hours,"h"]}),(0,s.jsxs)("span",{children:["Price: ",r.price_in_hours,"h credits"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4","aria-label":"Provider rating: ".concat(r.provider.rating," stars"),children:[(0,s.jsxs)("span",{className:"text-yellow-500",children:["★ ",r.provider.rating]}),(0,s.jsx)("span",{className:"text-gray-400",children:"•"}),(0,s.jsx)("span",{children:r.provider.location||"Remote"})]})]}),(0,s.jsx)("img",{src:r.provider.avatar_url||"/default-avatar.png",alt:"".concat(r.provider.username,"'s avatar"),className:"w-12 h-12 rounded-full ml-4"})]}),(0,s.jsx)("button",{onClick:()=>{if(!n){alert("Please log in to request a service.");return}o(!0)},disabled:c||"active"!==r.status||!n,className:"w-full py-2 px-4 rounded-md font-medium transition-colors ".concat(c||"active"!==r.status||!n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),"aria-label":n?"Request ".concat(r.title," from ").concat(r.provider.username):"Log in to request service",children:c?"Requested":"active"===r.status?"Request Service":"Unavailable"})]}),(0,s.jsx)(d,{isOpen:i,onClose:()=>o(!1),offering:r,onSuccess:()=>{u(!0),null==t||t()}})]})}var g=t(8357);function h(){let[e,r]=(0,a.useState)(""),[t,l]=(0,a.useState)("all"),[o,c]=(0,a.useState)(e);(0,a.useEffect)(()=>{let r=setTimeout(()=>c(e),400);return()=>clearTimeout(r)},[e]);let{data:{pages:u=[]}={},fetchNextPage:d,hasNextPage:h,isFetchingNextPage:m,isLoading:v,refetch:x}=(0,n.N)({queryKey:["serviceOfferings",{debouncedSearch:o,categoryFilter:t}],queryFn:async e=>{let{pageParam:r=0}=e,s=Number(r);return await (0,i.MW)(o,t,[s,s+10-1],"active")},getNextPageParam:(e,r)=>10===e.length?r.flat().length:void 0,initialPageParam:0}),{ref:p,inView:y}=(0,g.YD)({threshold:.3});(0,a.useEffect)(()=>{y&&h&&!m&&d()},[y,h,m,d]),(0,a.useEffect)(()=>(0,i.tt)("",e=>{e.some(e=>"active"===e.status)&&x()}),[x]);let b=(0,a.useMemo)(()=>u.flat(),[u]);return v&&0===b.length?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading marketplace..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-10",children:(0,s.jsxs)("div",{className:"container mx-auto px-4",children:[(0,s.jsxs)("header",{className:"mb-10 text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Community Marketplace"}),(0,s.jsx)("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Explore community-driven services. Search, filter, and collaborate instantly."}),!1]}),(0,s.jsx)("section",{className:"bg-white rounded-xl shadow-sm p-4 mb-8",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search services...",value:e,onChange:e=>r(e.target.value),className:"flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none","aria-label":"Search services"}),(0,s.jsxs)("select",{value:t,onChange:e=>l(e.target.value),className:"p-3 border rounded-lg focus:ring-2 focus:ring-blue-500","aria-label":"Filter by category",children:[(0,s.jsx)("option",{value:"all",children:"All Categories"}),(0,s.jsx)("option",{value:"technology",children:"Technology"}),(0,s.jsx)("option",{value:"creative",children:"Creative"}),(0,s.jsx)("option",{value:"education",children:"Education"}),(0,s.jsx)("option",{value:"health",children:"Health"}),(0,s.jsx)("option",{value:"business",children:"Business"}),(0,s.jsx)("option",{value:"trades",children:"Trades"}),(0,s.jsx)("option",{value:"other",children:"Other"})]})]})}),b.length>0?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(e=>(0,s.jsx)(f,{offering:{...e,provider:e.users}},e.id))}):!v&&(0,s.jsxs)("div",{className:"text-center py-20",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,s.jsx)("p",{className:"text-gray-500 text-lg",children:"No matching services found."}),(0,s.jsx)("p",{className:"text-gray-400 mt-2",children:e||"all"!==t?"Try refining your search or selecting a different category.":"Be the first to create a service offering!"})]}),(0,s.jsx)("div",{ref:p,className:"flex justify-center py-8",children:m&&(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-blue-500 border-t-transparent"})})]})})}},4951:function(e,r,t){t.d(r,{Be:function(){return n},MW:function(){return a},RS:function(){return i},tt:function(){return c},u6:function(){return o},ub:function(){return l}});var s=t(9263);async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,9],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{let n=s.O.from("service_offerings").select("\n        *,\n        users!service_offerings_user_id_fkey(username, avatar_url, location, rating),\n        skills(name, category)\n      ").order("created_at",{ascending:!1}).range(t[0],t[1]);a&&(n=n.eq("status",a)),e&&(n=n.or("title.ilike.%".concat(e,"%,description.ilike.%").concat(e,"%"))),"all"!==r&&(n=n.eq("skills.category",r));let{data:i,error:l}=await n;if(l)throw console.error("Error fetching service offerings:",l),l;return i||[]}catch(e){return console.error("Service offerings fetch failed:",e),[]}}async function n(e){try{let{data:r,error:t}=await s.O.from("service_offerings").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching user offerings:",t),t;return r||[]}catch(e){return console.error("User offerings fetch failed:",e),[]}}async function i(e,r){try{let{data:t,error:a}=await s.O.from("service_offerings").insert({...e,user_id:r}).select().single();if(a)throw console.error("Error creating offering:",a),a;return t}catch(e){return console.error("Create offering failed:",e),null}}async function l(e,r){try{let{data:t,error:a}=await s.O.from("service_offerings").update(r).eq("id",e).select().single();if(a)throw console.error("Error updating offering:",a),a;return t}catch(e){return console.error("Update offering failed:",e),null}}async function o(e){try{let{error:r}=await s.O.from("service_offerings").delete().eq("id",e);if(r)throw console.error("Error deleting offering:",r),r;return!0}catch(e){return console.error("Delete offering failed:",e),!1}}function c(e,r){let t=s.O.channel("service-offerings-changes").on("postgres_changes",{event:"*",schema:"public",table:"service_offerings",...e&&{filter:"user_id=eq.".concat(e)}},async()=>{r(e?await n(e):await a("","all",[0,100],"active"))}).subscribe();return()=>{t.unsubscribe()}}}}]);